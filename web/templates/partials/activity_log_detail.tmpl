{{define "activity_log_detail"}}
<div class="card border-0 shadow-sm border-start border-primary border-3">
    <div class="card-body">
        <div class="d-flex align-items-center justify-content-between mb-3">
            <h6 class="fw-bold mb-0">
                <i class="bi bi-journal-text me-2"></i>Log Details
            </h6>
            <button type="button" class="btn btn-sm btn-outline-secondary"
                    onclick="document.getElementById('log-detail-container').innerHTML = '';"
                    title="Close">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>

        <!-- Event info -->
        <div class="row g-3 mb-3">
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label small text-muted mb-1">Event Type</label>
                    <div>
                        <span class="badge bg-primary bg-opacity-10 text-primary">{{.EventType}}</span>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label small text-muted mb-1">Severity</label>
                    <div>
                        {{if eq .Severity "CRITICAL"}}
                            <span class="badge bg-danger">CRITICAL</span>
                        {{else if eq .Severity "IMPORTANT"}}
                            <span class="badge bg-warning text-dark">IMPORTANT</span>
                        {{else if eq .Severity "ERROR"}}
                            <span class="badge bg-danger">ERROR</span>
                        {{else if eq .Severity "WARNING"}}
                            <span class="badge bg-warning text-dark">WARNING</span>
                        {{else}}
                            <span class="badge bg-success bg-opacity-75">INFO</span>
                        {{end}}
                        {{if .IsAnomaly}}
                        <span class="badge bg-danger bg-opacity-10 text-danger ms-1"><i class="bi bi-exclamation-triangle-fill me-1"></i>Anomaly</span>
                        {{end}}
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label small text-muted mb-1">User</label>
                    <div>
                        {{if .UserEmail}}
                        <span class="fw-semibold">{{.UserEmail}}</span>
                        <br><small class="text-muted font-monospace">{{.UserID}}</small>
                        {{else}}
                        <span class="text-muted fst-italic">Unknown user</span>
                        <br><small class="text-muted font-monospace">{{.UserID}}</small>
                        {{end}}
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label small text-muted mb-1">Application</label>
                    <div>
                        {{if .AppName}}
                        <span class="fw-semibold">{{.AppName}}</span>
                        {{else}}
                        <span class="text-muted fst-italic">Unknown app</span>
                        {{end}}
                        <br><small class="text-muted font-monospace">{{.AppID}}</small>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label small text-muted mb-1">Timestamp</label>
                    <div>{{formatDateTimeFull .Timestamp}}</div>
                </div>
                <div class="mb-3">
                    <label class="form-label small text-muted mb-1">IP Address</label>
                    <div>
                        <span class="font-monospace">{{if .IPAddress}}{{.IPAddress}}{{else}}<span class="text-muted fst-italic">Not recorded</span>{{end}}</span>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label small text-muted mb-1">User Agent</label>
                    <div>
                        <small class="text-muted" style="word-break: break-all;">{{if .UserAgent}}{{.UserAgent}}{{else}}<span class="fst-italic">Not recorded</span>{{end}}</small>
                    </div>
                </div>
                {{if .ExpiresAt}}
                <div class="mb-3">
                    <label class="form-label small text-muted mb-1">Expires At</label>
                    <div><small class="text-muted">{{.ExpiresAt.Format "Jan 02, 2006 15:04:05 MST"}}</small></div>
                </div>
                {{end}}
            </div>
        </div>

        <!-- Details section -->
        <h6 class="fw-bold mb-2 mt-3 pt-3 border-top">
            <i class="bi bi-code-square me-2"></i>Details (JSON)
        </h6>
        {{if .Details}}
        <pre class="bg-light p-3 rounded small mb-0" style="max-height: 300px; overflow-y: auto; white-space: pre-wrap; word-break: break-all;">{{.Details}}</pre>
        {{else}}
        <p class="text-muted small mb-0">No additional details recorded.</p>
        {{end}}

        <!-- Log ID -->
        <div class="mt-3 pt-3 border-top">
            <small class="text-muted font-monospace">Log ID: {{.ID}}</small>
        </div>
    </div>
</div>
{{end}}
